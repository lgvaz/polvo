# Miscellaneous


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

------------------------------------------------------------------------

<a
href="https://github.com/lgvaz/polvo/blob/master/polvo/utils/misc.py#L18"
target="_blank" style="float:right; font-size:smaller">source</a>

### flatten

>      flatten (x)

*From https://stackoverflow.com/a/2158532/6772672*

``` python
test_eq(flatten([[2, 3], ['a', ['c', 4]]]), [2, 3, 'a', 'c', 4])
```

------------------------------------------------------------------------

<a
href="https://github.com/lgvaz/polvo/blob/master/polvo/utils/misc.py#L25"
target="_blank" style="float:right; font-size:smaller">source</a>

### sort_quadrilateral

>      sort_quadrilateral (points)

``` python
test_points = np.array([(1.8, 2.1), (2, 0.9), (1.1, 1.95), (1, 1)])
expected_points = np.array([(1, 1), (2, 0.9), (1.8, 2.1), (1.1, 1.95)])
expected_idxs = np.array([3, 1, 0, 2])
test_eq(sort_quadrilateral(test_points), (expected_points, expected_idxs))
```

``` python
test_points = np.array([[1368.4, 1856.], [270.5, 1815.3], [1436.6, 77.7], [340.2, 27.5]])
expected_points = np.array([[340.2, 27.5], [1436.6, 77.7], [1368.4, 1856.], [270.5, 1815.3]])
expected_idxs = np.array([3, 2, 0, 1])
test_eq(sort_quadrilateral(test_points), (expected_points, expected_idxs))
```

------------------------------------------------------------------------

<a
href="https://github.com/lgvaz/polvo/blob/master/polvo/utils/misc.py#L36"
target="_blank" style="float:right; font-size:smaller">source</a>

### kwargs_grid

>      kwargs_grid (**kwargs)

*Returns a generator with all combinations of kwargs*

``` python
list(kwargs_grid(size=[(224, 224), (512, 512)], alpha=[0.3, 0.7, 0.9], apply_tfms=[False, True]))
```

    [{'size': (224, 224), 'alpha': 0.3, 'apply_tfms': False},
     {'size': (224, 224), 'alpha': 0.3, 'apply_tfms': True},
     {'size': (224, 224), 'alpha': 0.7, 'apply_tfms': False},
     {'size': (224, 224), 'alpha': 0.7, 'apply_tfms': True},
     {'size': (224, 224), 'alpha': 0.9, 'apply_tfms': False},
     {'size': (224, 224), 'alpha': 0.9, 'apply_tfms': True},
     {'size': (512, 512), 'alpha': 0.3, 'apply_tfms': False},
     {'size': (512, 512), 'alpha': 0.3, 'apply_tfms': True},
     {'size': (512, 512), 'alpha': 0.7, 'apply_tfms': False},
     {'size': (512, 512), 'alpha': 0.7, 'apply_tfms': True},
     {'size': (512, 512), 'alpha': 0.9, 'apply_tfms': False},
     {'size': (512, 512), 'alpha': 0.9, 'apply_tfms': True}]

------------------------------------------------------------------------

### zip

*zip(*iterables, strict=False) –\> Yield tuples until an input is
exhausted.

> > > list(zip(‘abcdefg’, range(3), range(4))) \[(‘a’, 0, 0), (‘b’, 1,
> > > 1), (‘c’, 2, 2)\]

The zip object yields n-length tuples, where n is the number of
iterables passed as positional arguments to zip(). The i-th element in
every tuple comes from the i-th iterable argument to zip(). This
continues until the shortest argument is exhausted.

If strict is true and one of the arguments is exhausted before the
others, raise a ValueError.\*

``` python
test_eq(list(safe_zip([1, 2], [3, 4], [5, 6])), list(zip([1, 2], [3, 4], [5, 6])))
```

``` python
test_fail(lambda: safe_zip([1, 2], [3, 4], [5]), contains='same size')
```

------------------------------------------------------------------------

<a
href="https://github.com/lgvaz/polvo/blob/master/polvo/utils/misc.py#L48"
target="_blank" style="float:right; font-size:smaller">source</a>

### skip_error

>      skip_error (fn, log=True)

*Returns the error instead of raising it.*

``` python
skip_error(lambda: 'test'.get(2))()
```

    'str' object has no attribute 'get' ((), {})

    AttributeError("'str' object has no attribute 'get'")

------------------------------------------------------------------------

<a
href="https://github.com/lgvaz/polvo/blob/master/polvo/utils/misc.py#L60"
target="_blank" style="float:right; font-size:smaller">source</a>

### Cache

>      Cache (func, save_dir=None, debug=False)

*Initialize self. See help(type(self)) for accurate signature.*

``` python
cache = Cache(lambda x: x+1, debug=True)
cache.get('test_cache.pkl', x=4, use_cache=True)
```

    Using cache.

    5

``` python
cache.list_cached()
```

    (#6) [Path('/home/lgvaz/.cache/polvo/test_cache444.pkl'),Path('/home/lgvaz/.cache/polvo/OpenAIEncoder-the_loop_manual_de_regras_em_portugues_211955.pdf-chunks.pkl'),Path('/home/lgvaz/.cache/polvo/test_cache.pkl'),Path('/home/lgvaz/.cache/polvo/test_cache2.pkl'),Path('/home/lgvaz/.cache/polvo/test_cache'),Path('/home/lgvaz/.cache/polvo/OpenAIEncoder/the_loop_manual_de_regras_em_portugues_211955.pdf-embeds.pkl')]

------------------------------------------------------------------------

<a
href="https://github.com/lgvaz/polvo/blob/master/polvo/utils/misc.py#L86"
target="_blank" style="float:right; font-size:smaller">source</a>

### transparent_cmap

>      transparent_cmap ()

``` python
# FIND CORRECT PLACE TO PLACE THIS
def wandb_upload(project:str, artifact_name:str, *path:str, type='dataset'):
    "Uploads files or dir to wandb"
    import wandb
    run = wandb.init(project=project, job_type="data-upload")
    artifact = wandb.Artifact(artifact_name, type=type)
    
    def _add_file(p): artifact.add_file(p, p)
    for p in path:
        if Path(p).is_file(): _add_file(p)
        else:
            for f in pv.get_files(p): _add_file(f)

    run.log_artifact(artifact)
```

``` python
class ParameterIterator:
    def __call__(self, f):
        sig = inspect.signature(f)
        @functools.wraps(f)
        def wrapper(*args, **kwargs):
            bound = sig.bind(*args, **kwargs)
            for k, v in bound.arguments.items():
                self.apply(k, v)
            return f(*args, **kwargs)
        return wrapper
```

``` python
def _save_image(image, save_dir): return pv.save_image(image, save_dir)

class save_params(ParameterIterator):
    _save_fns = {
        Image: pv.save_image,
        np.ndarray: pv.save_image,
        numbers.Number: lambda s: pv.save_txt(s+'\n', append=True),
        str: lambda s: pv.save_txt(s+'\n', append=True),
    }
    
    def __init__(
        self,
        save_dir,
        save_fns=None, # Dictionary of {<type>: save_fn}. `save_fn` first parameter should be the object, and second the path.
    ):
        "Save all parameters of decorated function"
        self.save_dir = pv.mkdir(save_dir, exist_ok=True)
        self.save_fns = save_fns or self._save_fns.copy()
        
    def apply(self, k, v):
        save_fns[type(k)](v, self.save_dir)
```

``` python
# @save_params('foo_params')
# def foo(a, b, c=2, d='test'):
#     return
```

------------------------------------------------------------------------

<a
href="https://github.com/lgvaz/polvo/blob/master/polvo/utils/misc.py#L92"
target="_blank" style="float:right; font-size:smaller">source</a>

### partial

>      partial (func, *args, **kwargs)

*Wraps functools.partial, same functionality. Modifies the original
partial `__repr__` and `__str__`.*

------------------------------------------------------------------------

<a
href="https://github.com/lgvaz/polvo/blob/master/polvo/utils/misc.py#L111"
target="_blank" style="float:right; font-size:smaller">source</a>

### random_local_seed

>      random_local_seed (seed)
